<!DOCTYPE html>
<html>
<head>
    <title>ShoppingList</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
    <!-- Google Fonts -->
    <!--    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet"/>-->
    <!-- MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <style>
        .thumb {
            width: 100px;
            height: 100px;
            margin-right: 1rem;
        }

        .img-fluid{
            max-width: 128px;
        }

        .main {
            display: flex;
        }

        .main .content {
            flex: 1;
        }
    </style>
</head>
<body>
<main class="main">
    <header>
        <div class="d-flex flex-column align-items-stretch flex-shrink-0 bg-white" style="width: 380px;">
            <a href="/"
               class="d-flex align-items-center flex-shrink-0 p-3 link-dark text-decoration-none border-bottom">
                <span class="fs-5 fw-semibold">List group</span>
            </a>
            <div class="list-group list-group-flush border-bottom scrollarea" id="categories_list">
            </div>
        </div>
    </header>
    <div class="content">
        <div class="d-flex align-items-center flex-shrink-0 p-3 link-dark text-decoration-none border-bottom">
            <span class="fs-5 fw-semibold">Articles</span>
        </div>
        <div class="container pt-4">
            <div class="articles" id="articles_list">

            </div>

        </div>
    </div>

</main>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    const URL_CATEGORIES = "http://127.0.0.1:8000/api/article-category/get";
    const URL_ARTICLES = "http://127.0.0.1:8000/api/article-category/get-articles";

    const cats_element = document.getElementById('categories_list')
    const articles_element = document.getElementById('articles_list')

    let categories;
    let articles;
    axios.get(URL_CATEGORIES)
        .then(res => {
            console.log(res)
            categories = res.data.status === 'success'
                ? res.data.data
                : {};
            updateCategoriesList(categories);
        })


    function updateArticleList(cat) {
        const id_cat = cat.dataset.id;

        axios.get(`${URL_ARTICLES}/${id_cat}`)
            .then(res => {
                console.log(res)
                articles = res.data.status === 'success'
                    ? res.data.data
                    : {};

                articles_element.innerHTML = "";

                articles.forEach(article => {
                    let content = createArticleElement(article);
                    articles_element.innerHTML += content;
                })

            })

        console.log(id_cat)
    }



    function createArticleElement(article) {
        let html = `<div class="row">`

        //Article cover image
        html += `<div class="col-md-4 mb-4">`
        html += `    <div class="bg-image hover-overlay shadow-1-strong rounded ripple ripple-surface-light">`
        html += `        <img src="${article.cover}" class="img-fluid">`
        html += `    </div>`
        html += `</div>`

        //Article text
        html += `<div class="col-md-8 mb-4">`
        html += `<h5>${article.title}</h5>`
        html += `<p>${article.lead}</p>`
        html += `<button type="button" class="btn btn-primary">Read</button>`
        html += `</div>`

        html += `</div>`
        return html;
    }

    function updateCategoriesList(cats) {
        console.log(cats);
        cats_element.innerHTML = "";
        cats.forEach(cat => {
            let content = createCategoryElement(cat);
            cats_element.innerHTML += content
        })

    }

    function createCategoryElement(cat) {
        let html = `<div href="#" class="list-group-item list-group-item-action d-flex py-3" id="category_element" data-id="${cat.id}" onclick="updateArticleList(this)">`;

        if (cat.cover) {
            html += `<div><img class="thumb" src="${cat.cover}" alt=""></div>`
        }

        html += `<div>`
        html += `<strong class="mb-1">${cat.title}</strong>`;
        html += `<div class="col-10 mb-1 small">${cat.lead}</div>`
        html += `</div>`

        html += "</div>";

        return html;
    }

</script>

<!--  <script>-->
<!--    const electron = require('electron');-->
<!--    const {ipcRenderer} = electron;-->
<!--    const ul = document.querySelector('ul');-->

<!--    ipcRenderer.on('item:add', function(e, item){-->
<!--      ul.className = 'collection';-->
<!--      const li = document.createElement('li');-->
<!--      li.className = 'collection-item';-->
<!--      const itemText = document.createTextNode(item);-->

<!--      li.appendChild(itemText);-->
<!--      ul.appendChild(li);-->
<!--    });-->

<!--    ipcRenderer.on('item:clear', function(){-->
<!--      ul.className = '';-->
<!--      ul.innerHTML = '';-->
<!--    });-->

<!--    ul.addEventListener('dblclick', removeItem);-->

<!--    function removeItem(e){-->
<!--      event.target.remove();-->
<!--      if(ul.children.length == 0){-->
<!--        ul.className = '';-->
<!--      }-->
<!--    }-->
<!--  </script>-->
</body>
</html>